{% extends 'base.html' %}

{% block body %}
<div class="flex-container-generic">
    <div class="page-header">
        <h1> Participant Details - {{participant.fname}} {{participant.lname}} </h1>
    </div>
    <div class="flex-row">
        <div class="flex-box-generic">
            <ul id="participant-info">
                <li><h2>name: {{participant.fname}} {{participant.lname}}</h2></li>
                <li><h2>participant ID: <span id="participant-id">{{participant.participant_id}}</span></h2></li>
                <li id="email">email: <span>{{participant.email}}</span></li>
                <li id="phone">phone: <span>{{participant.phone}}</span></li>
                <li>dob: {{participant.dob}}</li>
            </ul>
        </div>

        <div class="flex-box-generic">
            <ul id="participant-hcp-info">
                <li><h2 id="hcp_fullname">doctor name: <span>{{participant.hcp_fullname}}</span></h2></li>
                <li id="hcp_email">email: <span >{{participant.hcp_email}}</span></li>
                <li id="hcp_phone">phone: <span >{{participant.hcp_phone}}</span></li>
                <li id="hcp_practice">practice: <span >{{participant.hcp_practice}}</span></li>
            </ul>
        </div>
    </div>
        <div id="update-success" class="flex-center"></div><br>
        <button id="update-details-button" class="button">Update Information</button>


    <h2>studies that participant is in: </h2>
    <table>
        <thead>
            <tr>
                <td><b>Study</b></td>
                <td><b>Study ID</b></td>
                <td><b>Study Status</b></td>
            </tr>
        </thead>
        <tbody>
            {% for study in participant.studies %}
            <tr>
                <td>{{study.study_name}}</td>
                <td>{{study.study_id}}</td>
                <td>{{study.status}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <h2>Participant Results & Decisions</h2>
    {% for study in participant.studies %}
    <h3>{{study.study_name}}</h3>
    <table>
        <thead>
            <tr>
                <td><b>Visit</b></td>
                <td><b>Test Name</b></td>
                <td><b>Urgency Potential</b></td>
                <td><b>Return Plan</b></td>
                <td><b>Decision to Receive</b><br><a href="/decisions/{{study.study_id}}/{{participant.participant_id}}">(click to update)</a></td>
                <td><b>Result Value</b></td>
                <td><b>Urgency</b></td>
                <td><b>Notified</b></td>
            </tr>
        </thead>
        <tbody>
            {% for result in participant.results if result.result_plan.study.study_id == study.study_id %}
            <tr>
                <td>{{result.result_plan.visit}}</td>
                <td>{{result.result_plan.test_name}}</td>
                <td>{{result.result_plan.urgency_potential}}</td>
                <td>{{result.result_plan.return_plan}}</td>
                <td>{{result.receive_decision}}</td>
                <td>{{result.result_value}}</td>
                <td>{{result.urgent}} </td>
                <td>{{result.notified}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}

{% endblock %}

{% block js %} 
<script src="/static/js/update-details.js"></script>
{% endblock %}